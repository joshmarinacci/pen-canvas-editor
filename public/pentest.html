<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <style type="text/css">
        canvas {
            border: 3px solid red;
        }
        canvas {
            touch-action: none;
            /*user-select: none;*/
        }
        canvas {
            /*-ms-touch-action: none;*/
            /*touch-action: none;*/
        }
    </style>
</head>
<body>
<canvas id='canvas' width="400" height="400"></canvas>
<script type="module">

    class Point {
        constructor(x, y) {
            this.x = x
            this.y = y
        }

        minus(pt) {
            return new Point(
                this.x - pt.x,
                this.y - pt.y
            )
        }

        plus(pt) {
            return new Point(
                this.x + pt.x,
                this.y + pt.y
            )
        }

        copy() {
            return new Point(this.x, this.y)
        }
        copyFrom(pt) {
            this.x = pt.x
            this.y = pt.y
        }
        dist(pt) {
            let dx = this.x - pt.x
            let dy = this.y - pt.y
            return Math.sqrt(dx*dx + dy*dy)
        }
        div(val) {
            return new Point(
                this.x/val,
                this.y/val
            )
        }
    }


    const canvas = document.getElementById('canvas')
    let pressed = false
    canvas.addEventListener('pointerdown',(e)=>{
        pressed = true
        console.log("poitner down",{
            id:e.pointerId, type:e.pointerType,
            // tilt:[e.tiltX, e.tiltY],
            // twist:e.twist,
            // pressure:[e.pressure, e.tangentialPressure],
            primary:e.isPrimary,
            button:e.button,
            buttons:e.buttons,
            detail:e.detail,
            size:[e.width, e.height]
        })
        if(e.pointerType === 'pen') {
            if(e.buttons > 0) {
                console.log("a button is down")
                if((e.buttons & 32)>>5 > 0) {
                    console.log("it is erase")
                }
                if((e.buttons & 1)>>0 > 0) {
                    console.log("it is draw")
                }
            }
        }
    })
    function getPoint(e) {
        const rect = e.target.getBoundingClientRect()
        let pt = new Point(
            e.clientX - rect.left,
            e.clientY - rect.top
        )
        const scale = Math.pow(2,0)*1
        pt = pt.div(scale)
        return pt
    }

    canvas.addEventListener('pointermove',(e)=>{
        if(!pressed) return
        const ctx = canvas.getContext('2d')
        ctx.fillStyle = 'white'
        ctx.fillRect(0,0,canvas.width,canvas.height)
        ctx.fillStyle = 'black'
        const pt = getPoint(e)
        ctx.fillRect(pt.x,pt.y,3,3)
        ctx.strokeStyle = 'black'
        ctx.beginPath()
        ctx.arc(pt.x,pt.y,10,0,Math.PI*2)
        ctx.stroke()
    })
</script>
</body>
</html>
