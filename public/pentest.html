<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <style type="text/css">
        canvas {
            border: 3px solid red;
        }
        canvas {
            touch-action: manipulation;
            user-select: none;
        }
        #wrapper {
            border: 5px solid red;
            width: 200px;
            height: 200px;
            overflow: scroll;
        }
    </style>
</head>
<body>
<div id="wrapper">
    <canvas id='canvas' width="400" height="400"></canvas>
</div>
<script type="module">

    class Point {
        constructor(x, y) {
            this.x = x
            this.y = y
        }

        minus(pt) {
            return new Point(
                this.x - pt.x,
                this.y - pt.y
            )
        }

        plus(pt) {
            return new Point(
                this.x + pt.x,
                this.y + pt.y
            )
        }

        copy() {
            return new Point(this.x, this.y)
        }
        copyFrom(pt) {
            this.x = pt.x
            this.y = pt.y
        }
        dist(pt) {
            let dx = this.x - pt.x
            let dy = this.y - pt.y
            return Math.sqrt(dx*dx + dy*dy)
        }
        div(val) {
            return new Point(
                this.x/val,
                this.y/val
            )
        }
    }


    const canvas = document.getElementById('canvas')
    let pressed = false
    canvas.addEventListener('pointerdown',(e)=>{
        console.log("type",e.pointerType)
        if(e.pointerType === 'touch') return
        pressed = true
        /*
        if(e.pointerType === 'pen') {
            console.log("stopping")
            if(e.buttons > 0) {
                console.log("a button is down")
                if((e.buttons & 32)>>5 > 0) {
                    console.log("it is erase")
                }
                if((e.buttons & 1)>>0 > 0) {
                    console.log("it is draw")
                }
            }
        }*/
    })
    //canvas.addEventListener("pointercancel",(e)=>{
        //console.log("canceled")
    //})
    canvas.addEventListener('touchstart',(e)=>{
//        console.log("cancling touch?")
        if(pressed) e.preventDefault()
    })
    function getPoint(e) {
        const rect = e.target.getBoundingClientRect()
        let pt = new Point(
            e.clientX - rect.left,
            e.clientY - rect.top
        )
        const scale = Math.pow(2,0)*1
        pt = pt.div(scale)
        return pt
    }

    canvas.addEventListener('pointermove',(e)=>{
        if(!pressed) return
        e.preventDefault()
        //console.log("coal",e.getCoalescedEvents())
        const ctx = canvas.getContext('2d')
        //ctx.fillStyle = 'white'
        // ctx.fillRect(0,0,canvas.width,canvas.height)
        ctx.fillStyle = 'black'
        const pt = getPoint(e)
        ctx.fillRect(pt.x,pt.y,3,3)
        ctx.strokeStyle = 'black'
        ctx.beginPath()
        ctx.arc(pt.x,pt.y,10,0,Math.PI*2)
        ctx.stroke()
    })
    canvas.addEventListener('pointerup',(e) => {
        console.log("up")
        pressed = false
    })
</script>
</body>
</html>
